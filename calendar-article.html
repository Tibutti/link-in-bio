<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  
    <title>Embedding the Github Contributions Calendar &#9642; Shellscape Software</title>
  

  
    <meta name="description" content="While working on the site rewriteand projects page I was looking for a way to display more data on myopen source work, on the site’s left-side panel. I went with that base layout toshow interesting data, after all. The Github Contribution Calendarseemed like a natural choice.">
  

  
    <meta name="keywords" content="cors, esnext, fetch, github, javascript, site">
  

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://shellscape.org/assets/images/posts/embedding-github-contribution-calendar.png">


<meta name="twitter:title" content="Embedding the Github Contributions Calendar">


  <meta name="twitter:description" content="While working on the site rewriteand projects page I was looking for a way to display more data on myopen source work, on the site’s left-side panel. I went with that base layout toshow interesting data, after all. The Github Contribution Calendarseemed like a natural choice.">



  <meta name="twitter:site" content="@shellscape">
  <meta name="twitter:creator" content="@shellscape">


  

<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Embedding the Github Contributions Calendar">

  <meta prefix="og: http://ogp.me/ns#" property="og:description" content="While working on the site rewriteand projects page I was looking for a way to display more data on myopen source work, on the site’s left-side panel. I went with that base layout toshow interesting data, after all. The Github Contribution Calendarseemed like a natural choice.">

<meta prefix="og: http://ogp.me/ns#" property="og:url" content="http://shellscape.org/2016/08/31/embedding-github-contribution-calendar">
<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://shellscape.org/assets/images/posts/embedding-github-contribution-calendar.png">
<meta prefix="og: http://ogp.me/ns#" property="og:type" content="blog">
<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="Shellscape Software">
<meta prefix="og: http://ogp.me/ns#" property="og:locale" content="en_US">



  <link rel="canonical" href="http://shellscape.org/2016/08/31/embedding-github-contribution-calendar">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link type="application/atom+xml" rel="alternate" href="http://shellscape.org/feed.xml" title="Shellscape Software" />

  <link rel="shortcut icon" href="/assets/images/favicons/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/assets/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/assets/images/favicons/manifest.json">
  <link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Open+Sans:300,400,700" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

  
  
  
  
  
  <style type="text/css">
    #left {
      background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url(/assets/images/posts/embedding-github-contribution-calendar.png) no-repeat !important;
      background-size: cover !important;
      
    }
  </style>
  
</head>

<body id="post" class="">

  
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<aside class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Perceptions, Projects, and Software from the grey matter of Andrew Powell</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        <a class="sidebar-nav-item" href="/">Hello. Is It Me You’re Looking For?</a>
      
    
      
    
      
        <a class="sidebar-nav-item" href="/apps">Apps</a>
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a class="sidebar-nav-item" href="/posts">Posts</a>
      
    
      
        <a class="sidebar-nav-item" href="/projects">Projects</a>
      
    
      
    
      
    
      
        <a class="sidebar-nav-item" href="/tags">Tags</a>
      
    

  </nav>

  <div class="sidebar-item">
    <p>
      The full source code for this site is available
      <a href="https://github.com/shellscape/shellscape.github.io">on Github</a>.
    </p>
  </div>

  <ul class="social-links">
  <li>
    <a class="social-btn social-github" href="http://github.com/shellscape" target="_blank" rel="noopener noreferrer">
      <i class="fa fa-fw fa-github"></i>
    </a>
  </li>
  <li>
    <a class="social-btn" href="http://linkedin.com/in/powellonaboat" target="_blank" rel="noopener noreferrer">
      <i class="fa fa-fw fa-linkedin"></i>
    </a>
  </li>
  <li>
    <a class="social-btn" href="http://stackoverflow.com/users/416845/shellscape" target="_blank" rel="noopener noreferrer">
      <i class="fa fa-fw fa-stack-overflow"></i>
    </a>
  </li>
</ul>


</aside>


  <main>
    <section id="left">
      <div class="content">
        
        <a href="/" class="logo"><img src="/assets/images/shellscape-2016.svg"></a>
<div class="post-title-section">
  <h3>Posts <em>/</em></h3>
  <h1 class="section-title">Embedding the Github Contributions Calendar
</h1>
  <ul class="tags">
    
      <li><a href="/tags#cors">cors</a></li>
      
    
      <li><a href="/tags#esnext">esnext</a></li>
      
    
      <li><a href="/tags#fetch">fetch</a></li>
      
    
      <li><a href="/tags#github">github</a></li>
      
    
      <li><a href="/tags#javascript">javascript</a></li>
      
    
      <li><a href="/tags#site">site</a></li>
      
    
  </ul>
  <h3 class="reverse"><a href="/posts">Back to posts</a> <em>/</em></h3>
</div>

      </div>
    </section>

    <section id="right">
      <nav>
        <a href="/posts" title="The Blog" id="nav-posts">
          <div></div>
          <label title="Blog Posts">Posts</span>
        </a>
        <a href="/projects" title="Software / Projects" id="nav-projects">
          <div></div>
          <label title="Software / Projects">Projects</span>
        </a>
        <a title="Site Navigation" id="nav-sidebar">
          <label for="sidebar-checkbox"></label>
        </a>
      </nav>

      <div class="content">
        


<nav class="pager">
  
  <a href="/2016/08/29/shellscape-refresh-rewrite" title="Shellscape Refresh and Rewrite
">previous</a>
  
  
  <a href="/2016/09/02/ui-tracking-alternative-gumshoe" title="UI Tracking Alternative: Gumshoe
">next</a>
  
</nav>



<article>
  <div class="logo">
    <img src="/assets/images/shellscape-2016.svg">
  </div>
  <time>

August
31st
  ,
2016
</time>
  <p>While working on the <a href="http://shellscape.org/2016/08/29/shellscape-refresh-rewrite">site rewrite</a>
and <a href="/projects">projects page</a> I was looking for a way to display more data on my
open source work, on the site’s left-side panel. I went with that base layout to
show interesting data, after all. The <a href="https://help.github.com/articles/viewing-contributions-on-your-profile-page/">Github Contribution Calendar</a>
seemed like a natural choice.</p>

<!-- more -->

<p>In searching for something already written, I found <a href="https://github.com/IonicaBizau/github-calendar">github-calendar</a>.
That wasn’t a good fit for my needs, however.</p>

<h2 id="getting-dirty">Getting Dirty</h2>

<p>Since Github provides no API or embedding functionality for us we’re left with
two options:</p>

<ol>
  <li>Use the developer API, perform calculations, render the graph. aka.
Reinventing the Wheel.</li>
  <li>Good ol’ fashion screen scraping.</li>
</ol>

<p>Stuff that has been traditionally the realm of server-side processes can now be
done with the wonderful ESNext API <code class="language-plaintext highlighter-rouge">fetch</code>. Support for fetch <a href="http://caniuse.com/#feat=fetch">is pretty weak</a>
right now, but thankfully there’s a <a href="https://github.com/github/fetch">polyfill from Github</a>
that takes care of those browsers not yet with the hotness. Scraping Github for
the graph is as simple as hitting our profile url <code class="language-plaintext highlighter-rouge">https://github.com/{username}</code>.</p>

<h2 id="but-but-but-cross-origin">But, But, But Cross Origin</h2>

<p>That’s where a harmless proxy comes into play. Github doesn’t have CORS setup for
the profile pages, and that’s no surprise. Enter the <a href="http://ivanzuzak.info/urlreq/">Url Req Service</a>;
an open source proxy service which simply echoes HTTP responses and allows for CORS.
Magic.</p>

<h2 id="lets-fetch">Let’s Fetch</h2>

<p>Fetching and handling the response is straight-forward enough. Everything uses
promises so it’s rather painless.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://urlreq.appspot.com/req?method=GET&amp;url=</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">url</span> <span class="o">=</span> <span class="nx">proxy</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">https://github.com/shellscape</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="nx">fetchThen</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// response contains several streams, of which we need to fully read.</span>
    <span class="c1">// response.text() reads the entire stream and returns a Promise.</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="nx">responseThen</span> <span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">),</span>
      <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#github-graph</span><span class="dl">'</span><span class="p">),</span>
      <span class="nx">graph</span><span class="p">;</span>

    <span class="c1">// place the entire body of the page into a wrapper element.</span>
    <span class="c1">// it's not elegant, but it works.</span>
    <span class="nx">wrapper</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">body</span><span class="p">;</span>

    <span class="c1">// find the calendar/graph element in the response.</span>
    <span class="nx">graph</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">svg.js-calendar-graph-svg</span><span class="dl">'</span><span class="p">);</span>

    <span class="c1">// and finally add it to our page, within a pre-defined container element.</span>
    <span class="nx">container</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">;</span>
  <span class="p">});</span>
</code></pre></div></div>

<h3 id="season-to-taste">Season to Taste</h3>

<p>Since it’s an SVG, I could have resized this thing by applying CSS, but that’d be
ugly. Unfortunately, Github left out some key attributes that make SVGs play nice
with CSS selectors and XPath in all browsers. So let’s add those:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">graph</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">version</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">1.1</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">graph</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">xmlns</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://www.w3.org/2000/svg</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">graph</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">xmlns:xlink</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://www.w3.org/1999/xlink</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">graph</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">xml:space</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">preserve</span><span class="dl">'</span><span class="p">);</span>

</code></pre></div></div>

<p>And it was too wide for my left panel, so I trimmed some of the starting columns,
and then shifted the remaining to the left. (This also meant hiding shifting the
‘month’ headers left using CSS - Tip: <code class="language-plaintext highlighter-rouge">:nth-child</code> doesn’t work with <code class="language-plaintext highlighter-rouge">text</code> SVG
elements outside of a <code class="language-plaintext highlighter-rouge">g</code> parent.)</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">gs</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">graph</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">g g</span><span class="dl">'</span><span class="p">));</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">g</span> <span class="k">of</span> <span class="nx">gs</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">index</span> <span class="o">=</span> <span class="nx">gs</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">g</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">26</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">g</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">g</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">g</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">transform</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">translate(</span><span class="dl">'</span> <span class="o">+</span> <span class="p">(</span><span class="mi">13</span> <span class="o">*</span> <span class="p">(</span><span class="nx">index</span> <span class="o">-</span> <span class="mi">26</span><span class="p">))</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">, 0)</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And finally, the colors were way too bright for the left panel. Because there’s
no other way to identify the original colors of the <code class="language-plaintext highlighter-rouge">rect</code> elements in the SVG,
I had to use the <code class="language-plaintext highlighter-rouge">fill</code> attribute to map to the correct CSS classes.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">rect</span> <span class="k">of</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">rect</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">fill</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">fill</span><span class="dl">'</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">colors</span><span class="p">[</span><span class="nx">fill</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">rect</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">colors</span><span class="p">[</span><span class="nx">fill</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="tying-it-all-together">Tying it All Together</h2>

<p>The end result can be seen on my <a href="/projects">Projects page</a>.<br /><br /></p>

<script src="https://gist.github.com/a2ec2f0432a6383b94d18cb4417a1d10.js"> </script>

<h2 id="improvements-maybe">Improvements, Maybe?</h2>

<p>If and when I have the will to tinker with this again, I’ll likely implement some
caching within <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage">SessionStorage</a>
, or more likely <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">LocalStorage</a>
so that I’m not pinging the bajeezus out of my own profile page.</p>

</article>


<section id="share">
  <a href="https://twitter.com/intent/tweet?text=http://shellscape.org/2016/08/31/embedding-github-contribution-calendar" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=http://shellscape.org/2016/08/31/embedding-github-contribution-calendar" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>
  <a href="https://plus.google.com/share?url=http://shellscape.org/2016/08/31/embedding-github-contribution-calendar" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>
</section>



<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
  this.page.url = 'http://shellscape.org/2016/08/31/embedding-github-contribution-calendar';
  this.page.identifier = '/2016/08/31/embedding-github-contribution-calendar';
};

(function() {
    var d = document, s = d.createElement('script');
    s.src = '//shellscape-software.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>

      </div>

      <footer>&copy; 2023. Andrew Powell. All rights reserved.</footer>
    </section>

  </main>

  <!-- JS -->
<script src="/assets/js/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-78612-3', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


  
  

  
</body>
</html>
